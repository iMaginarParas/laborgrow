<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LaborGrow Admin</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:          #f0f4ff;
  --surface:     #ffffff;
  --surface2:    #f5f7ff;
  --border:      #e2e8f7;
  --border2:     #c7d2ee;
  --text:        #0f1733;
  --text2:       #3d4f7c;
  --muted:       #8896b8;
  --accent:      #2563eb;
  --accent-lt:   #dbeafe;
  --accent-dark: #1d4ed8;
  --danger:      #dc2626;
  --danger-lt:   #fee2e2;
  --warn:        #d97706;
  --warn-lt:     #fef3c7;
  --green:       #16a34a;
  --green-lt:    #dcfce7;
  --radius:      10px;
  --font-head:   'Plus Jakarta Sans', sans-serif;
  --font-body:   'DM Sans', sans-serif;
  --shadow-sm:   0 1px 3px rgba(37,99,235,.08), 0 1px 2px rgba(0,0,0,.04);
  --shadow:      0 4px 16px rgba(37,99,235,.1), 0 1px 4px rgba(0,0,0,.06);
  --shadow-lg:   0 12px 40px rgba(37,99,235,.14), 0 4px 12px rgba(0,0,0,.08);
}

html { scroll-behavior: smooth; }

body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  overflow-x: hidden;
}

/* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width: 5px; height: 5px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent); }

/* â”€â”€ Login Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#login-screen {
  position: fixed; inset: 0;
  background: linear-gradient(135deg, #1e40af 0%, #2563eb 40%, #3b82f6 70%, #60a5fa 100%);
  display: flex; align-items: center; justify-content: center;
  z-index: 1000;
  transition: opacity .4s ease, visibility .4s ease;
}
#login-screen::before {
  content: '';
  position: absolute; inset: 0;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
}
#login-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

.login-box {
  width: 420px;
  background: var(--surface);
  border-radius: 20px;
  padding: 44px 40px;
  box-shadow: var(--shadow-lg);
  animation: fadeUp .5s ease;
  position: relative;
}
.login-box::before {
  content: '';
  position: absolute;
  top: 0; left: 40px; right: 40px;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), #60a5fa);
  border-radius: 0 0 3px 3px;
}
.login-mark {
  width: 48px; height: 48px;
  background: linear-gradient(135deg, var(--accent), #60a5fa);
  border-radius: 14px;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
  margin-bottom: 20px;
  box-shadow: 0 4px 14px rgba(37,99,235,.35);
}
.login-logo {
  font-family: var(--font-head);
  font-size: 24px;
  font-weight: 800;
  color: var(--text);
  letter-spacing: -0.5px;
  margin-bottom: 4px;
}
.login-sub {
  font-size: 13px;
  color: var(--muted);
  margin-bottom: 32px;
}
.login-field { margin-bottom: 18px; }
.login-field label {
  display: block;
  font-size: 12px;
  font-weight: 600;
  color: var(--text2);
  margin-bottom: 7px;
}
.login-field input {
  width: 100%;
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  padding: 12px 14px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 14px;
  outline: none;
  transition: border-color .2s, box-shadow .2s;
}
.login-field input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(37,99,235,.12);
  background: #fff;
}
.login-btn {
  width: 100%;
  background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  color: #fff;
  border: none;
  border-radius: var(--radius);
  padding: 14px;
  font-family: var(--font-head);
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 6px;
  transition: opacity .2s, transform .1s, box-shadow .2s;
  box-shadow: 0 4px 14px rgba(37,99,235,.4);
  letter-spacing: .2px;
}
.login-btn:hover { opacity: .93; box-shadow: 0 6px 20px rgba(37,99,235,.5); }
.login-btn:active { transform: scale(.98); }
.login-error {
  margin-top: 12px;
  font-size: 12px;
  color: var(--danger);
  text-align: center;
  min-height: 18px;
  font-weight: 500;
}

/* â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sidebar {
  width: 230px;
  min-height: 100vh;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0; top: 0; bottom: 0;
  z-index: 100;
  box-shadow: 2px 0 16px rgba(37,99,235,.06);
}

.sidebar-logo {
  padding: 22px 20px 18px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}
.sidebar-logo-icon {
  width: 34px; height: 34px;
  background: linear-gradient(135deg, var(--accent), #60a5fa);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(37,99,235,.3);
}
.sidebar-logo-wrap {}
.sidebar-logo-text {
  font-family: var(--font-head);
  font-size: 16px;
  font-weight: 800;
  color: var(--text);
  letter-spacing: -0.3px;
  line-height: 1.1;
}
.sidebar-logo-sub {
  font-size: 10px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--muted);
}

.sidebar-nav { flex: 1; padding: 10px 0; overflow-y: auto; }

.nav-section-label {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--muted);
  padding: 14px 20px 5px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 9px;
  padding: 9px 16px;
  margin: 1px 8px;
  cursor: pointer;
  font-size: 13px;
  font-weight: 500;
  color: var(--text2);
  transition: color .15s, background .15s;
  border-radius: 8px;
  position: relative;
}
.nav-item:hover { color: var(--accent); background: var(--accent-lt); }
.nav-item.active {
  color: var(--accent);
  background: var(--accent-lt);
  font-weight: 600;
}
.nav-item.active::before {
  content: '';
  position: absolute;
  left: -8px; top: 20%; bottom: 20%;
  width: 3px;
  background: var(--accent);
  border-radius: 0 3px 3px 0;
}
.nav-item .icon { font-size: 15px; width: 20px; text-align: center; flex-shrink: 0; }
.nav-badge {
  margin-left: auto;
  background: var(--accent-lt);
  color: var(--accent);
  font-size: 10px;
  font-weight: 700;
  padding: 2px 7px;
  border-radius: 20px;
  min-width: 22px;
  text-align: center;
}
.nav-item.active .nav-badge { background: var(--accent); color: #fff; }

.sidebar-footer {
  padding: 14px 16px;
  border-top: 1px solid var(--border);
}
.logout-btn {
  width: 100%;
  background: none;
  border: 1.5px solid var(--border2);
  border-radius: var(--radius);
  padding: 9px;
  color: var(--muted);
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
  display: flex; align-items: center; justify-content: center; gap: 6px;
}
.logout-btn:hover { border-color: var(--danger); color: var(--danger); background: var(--danger-lt); }

/* â”€â”€ Main Content â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#main {
  margin-left: 230px;
  flex: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* â”€â”€ Topbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#topbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 28px;
  height: 60px;
  display: flex;
  align-items: center;
  gap: 16px;
  position: sticky;
  top: 0;
  z-index: 50;
  box-shadow: var(--shadow-sm);
}
.topbar-title {
  font-family: var(--font-head);
  font-size: 17px;
  font-weight: 700;
  flex: 1;
  color: var(--text);
}
.search-bar {
  display: flex;
  align-items: center;
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: 10px;
  padding: 0 12px;
  gap: 8px;
  width: 290px;
  transition: all .2s;
}
.search-bar:focus-within {
  border-color: var(--accent);
  background: #fff;
  box-shadow: 0 0 0 3px rgba(37,99,235,.1);
}
.search-bar input {
  background: none;
  border: none;
  outline: none;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 13px;
  padding: 10px 0;
  flex: 1;
}
.search-bar input::placeholder { color: var(--muted); }
.search-icon { color: var(--muted); font-size: 14px; }
.topbar-refresh {
  background: none;
  border: 1.5px solid var(--border);
  border-radius: var(--radius);
  padding: 8px 16px;
  color: var(--text2);
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
  display: flex; align-items: center; gap: 6px;
}
.topbar-refresh:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-lt); }

/* â”€â”€ Content Area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#content { padding: 28px; flex: 1; }

.page { display: none; animation: fadeUp .3s ease; }
.page.active { display: block; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* â”€â”€ Stat Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 28px;
}
.stat-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 22px 20px;
  position: relative;
  overflow: hidden;
  transition: box-shadow .2s, transform .2s;
  box-shadow: var(--shadow-sm);
}
.stat-card:hover { box-shadow: var(--shadow); transform: translateY(-1px); }
.stat-card-bg {
  position: absolute;
  right: -10px; top: -10px;
  width: 80px; height: 80px;
  border-radius: 50%;
  opacity: .07;
}
.stat-card.blue  .stat-card-bg { background: var(--accent); }
.stat-card.indigo .stat-card-bg { background: #6366f1; }
.stat-card.green .stat-card-bg { background: var(--green); }
.stat-card.warn  .stat-card-bg { background: var(--warn); }

.stat-card-top { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 14px; }
.stat-icon {
  width: 40px; height: 40px;
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
}
.stat-card.blue  .stat-icon { background: var(--accent-lt); }
.stat-card.indigo .stat-icon { background: #ede9fe; }
.stat-card.green .stat-icon { background: var(--green-lt); }
.stat-card.warn  .stat-icon { background: var(--warn-lt); }

.stat-value {
  font-family: var(--font-head);
  font-size: 34px;
  font-weight: 800;
  line-height: 1;
  margin-bottom: 4px;
  color: var(--text);
}
.stat-label {
  font-size: 12px;
  font-weight: 500;
  color: var(--muted);
}

/* â”€â”€ Section Headers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-header {
  display: flex; align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}
.section-title { font-family: var(--font-head); font-size: 15px; font-weight: 700; }
.section-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }

/* â”€â”€ Two Column Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 28px; }

/* â”€â”€ Table Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.table-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}
.table-header {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  background: var(--surface);
}
.table-title {
  font-family: var(--font-head);
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
}
.table-filters { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
.filter-input {
  background: var(--surface2);
  border: 1.5px solid var(--border);
  border-radius: 8px;
  padding: 7px 12px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 12px;
  outline: none;
  width: 190px;
  transition: all .2s;
}
.filter-input:focus {
  border-color: var(--accent);
  background: #fff;
  box-shadow: 0 0 0 3px rgba(37,99,235,.1);
}

table { width: 100%; border-collapse: collapse; }
thead tr { background: var(--surface2); border-bottom: 1px solid var(--border); }
th {
  text-align: left;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--muted);
  padding: 11px 16px;
}
td {
  padding: 12px 16px;
  font-size: 13px;
  border-bottom: 1px solid var(--border);
  vertical-align: middle;
  color: var(--text);
}
tbody tr:last-child td { border-bottom: none; }
tbody tr:hover { background: #f8faff; }

/* â”€â”€ Badges â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge {
  display: inline-block;
  padding: 3px 9px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}
.badge-green  { background: var(--green-lt);  color: var(--green); }
.badge-blue   { background: var(--accent-lt); color: var(--accent); }
.badge-warn   { background: var(--warn-lt);   color: var(--warn); }
.badge-danger { background: var(--danger-lt); color: var(--danger); }
.badge-gray   { background: #f1f5f9; color: #64748b; }

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 7px 14px;
  border-radius: 8px;
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
  border: none;
}
.btn-primary { background: var(--accent); color: #fff; box-shadow: 0 2px 8px rgba(37,99,235,.3); }
.btn-primary:hover { background: var(--accent-dark); box-shadow: 0 4px 12px rgba(37,99,235,.4); }
.btn-danger  { background: var(--danger-lt); color: var(--danger); border: 1px solid #fca5a5; }
.btn-danger:hover  { background: var(--danger); color: #fff; border-color: var(--danger); }
.btn-ghost   { background: none; color: var(--text2); border: 1.5px solid var(--border); }
.btn-ghost:hover   { border-color: var(--accent); color: var(--accent); background: var(--accent-lt); }
.btn-sm { padding: 5px 10px; font-size: 11px; }

/* â”€â”€ Pagination â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pagination {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  border-top: 1px solid var(--border);
  background: var(--surface2);
  font-size: 12px;
  color: var(--muted);
  font-weight: 500;
}
.page-btns { display: flex; gap: 6px; }
.page-btn {
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 7px;
  padding: 5px 12px;
  color: var(--text2);
  font-family: var(--font-body);
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s;
}
.page-btn:hover:not(:disabled) { border-color: var(--accent); color: var(--accent); background: var(--accent-lt); }
.page-btn:disabled { opacity: .4; cursor: default; }

/* â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(15,23,51,.4);
  backdrop-filter: blur(6px);
  display: flex; align-items: center; justify-content: center;
  z-index: 500;
  opacity: 0; visibility: hidden;
  transition: all .25s;
}
.modal-overlay.open { opacity: 1; visibility: visible; }

.modal {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  width: 540px;
  max-height: 82vh;
  overflow-y: auto;
  transform: scale(.96) translateY(10px);
  transition: transform .25s;
  box-shadow: var(--shadow-lg);
}
.modal-overlay.open .modal { transform: scale(1) translateY(0); }

.modal-head {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: var(--surface2);
}
.modal-title { font-family: var(--font-head); font-size: 15px; font-weight: 700; color: var(--text); }
.modal-close {
  background: none; border: none; color: var(--muted);
  font-size: 20px; cursor: pointer; padding: 4px; line-height: 1;
  transition: color .2s; border-radius: 6px;
}
.modal-close:hover { color: var(--danger); background: var(--danger-lt); }
.modal-body { padding: 24px; }
.modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  background: var(--surface2);
}

/* â”€â”€ Detail Fields â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.detail-field label {
  display: block;
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 5px;
}
.detail-field .value { font-size: 13px; color: var(--text); font-weight: 500; word-break: break-all; }
.detail-field.full { grid-column: 1/-1; }

/* â”€â”€ Loading / Empty â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.loading-row td { text-align: center; padding: 36px; color: var(--muted); font-size: 13px; }
.empty-row td   { text-align: center; padding: 44px; color: var(--muted); font-size: 13px; }

.spinner {
  display: inline-block;
  width: 16px; height: 16px;
  border: 2px solid var(--border2);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin .6s linear infinite;
  vertical-align: middle;
  margin-right: 8px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#toast-container {
  position: fixed;
  bottom: 24px; right: 24px;
  display: flex; flex-direction: column; gap: 10px;
  z-index: 900;
}
.toast {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 13px 18px;
  font-size: 13px;
  font-weight: 500;
  display: flex; align-items: center; gap: 10px;
  min-width: 280px;
  animation: slideIn .3s ease;
  transition: opacity .3s;
  box-shadow: var(--shadow);
  color: var(--text);
}
.toast.success { border-left: 3px solid var(--green); }
.toast.error   { border-left: 3px solid var(--danger); }
.toast.info    { border-left: 3px solid var(--accent); }
.toast.fading  { opacity: 0; }
@keyframes slideIn {
  from { opacity: 0; transform: translateX(16px); }
  to   { opacity: 1; transform: translateX(0); }
}

/* â”€â”€ Search Results Dropdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.search-results {
  position: absolute;
  top: 100%;
  left: 0; right: 0;
  background: var(--surface);
  border: 1.5px solid var(--border);
  border-radius: 12px;
  margin-top: 6px;
  max-height: 380px;
  overflow-y: auto;
  z-index: 200;
  box-shadow: var(--shadow-lg);
}
.search-results-section { padding: 6px 0; border-bottom: 1px solid var(--border); }
.search-results-section:last-child { border-bottom: none; }
.search-results-label {
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--muted);
  padding: 8px 14px 4px;
}
.search-result-item {
  padding: 9px 14px;
  cursor: pointer;
  transition: background .15s;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}
.search-result-item:hover { background: var(--surface2); }
.search-result-name  { font-size: 13px; font-weight: 500; color: var(--text); }
.search-result-sub   { font-size: 11px; color: var(--muted); }

/* â”€â”€ Confirm Dialog â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.confirm-overlay {
  position: fixed; inset: 0;
  background: rgba(15,23,51,.45);
  backdrop-filter: blur(6px);
  display: flex; align-items: center; justify-content: center;
  z-index: 600;
  opacity: 0; visibility: hidden;
  transition: all .2s;
}
.confirm-overlay.open { opacity: 1; visibility: visible; }
.confirm-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 32px 28px;
  width: 380px;
  text-align: center;
  transform: scale(.95);
  transition: transform .2s;
  box-shadow: var(--shadow-lg);
}
.confirm-overlay.open .confirm-box { transform: scale(1); }
.confirm-icon { font-size: 36px; margin-bottom: 16px; }
.confirm-title { font-family: var(--font-head); font-size: 17px; font-weight: 700; margin-bottom: 8px; color: var(--text); }
.confirm-msg   { font-size: 13px; color: var(--muted); line-height: 1.6; margin-bottom: 24px; }
.confirm-btns  { display: flex; gap: 10px; justify-content: center; }

/* â”€â”€ Misc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.text-muted  { color: var(--muted); }
.text-accent { color: var(--accent); font-weight: 600; }
.text-danger { color: var(--danger); }
.truncate { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
.mb-4 { margin-bottom: 16px; }
.mb-6 { margin-bottom: 24px; }
.search-wrapper { position: relative; }

/* â”€â”€ Recent lists (dashboard) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.recent-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 0; border-bottom: 1px solid var(--border); gap: 12px;
}
.recent-item:last-child { border-bottom: none; }
.recent-item-name  { font-size: 13px; font-weight: 500; color: var(--text); }
.recent-item-sub   { font-size: 11px; color: var(--muted); margin-top: 2px; }
.recent-item-right { text-align: right; flex-shrink: 0; }

/* â”€â”€ Skill tags â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.skill-tag {
  display: inline-block;
  background: var(--accent-lt);
  border: 1px solid #bfdbfe;
  border-radius: 5px;
  padding: 2px 8px;
  font-size: 11px;
  margin: 2px;
  color: var(--accent);
  font-weight: 500;
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-box">
    <div class="login-mark">âš¡</div>
    <div class="login-logo">LaborGrow</div>
    <div class="login-sub">Sign in to the admin panel</div>
    <div class="login-field">
      <label>Admin Secret Key</label>
      <input type="password" id="login-key" placeholder="Enter your secret key" autocomplete="off">
    </div>
    <button class="login-btn" onclick="doLogin()">Access Panel â†’</button>
    <div class="login-error" id="login-error"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav id="sidebar">
  <div class="sidebar-logo">
    <div class="sidebar-logo-icon">âš¡</div>
    <div class="sidebar-logo-wrap">
      <div class="sidebar-logo-text">LaborGrow</div>
      <div class="sidebar-logo-sub">Admin Panel</div>
    </div>
  </div>
  <div class="sidebar-nav">
    <div class="nav-section-label">Overview</div>
    <div class="nav-item active" onclick="navigate('dashboard')">
      <span class="icon">â—ˆ</span> Dashboard
    </div>

    <div class="nav-section-label">Users</div>
    <div class="nav-item" onclick="navigate('allusers')">
      <span class="icon">ğŸ‘¥</span> All Registered
      <span class="nav-badge" id="badge-allusers">â€”</span>
    </div>
    <div class="nav-item" onclick="navigate('employers')">
      <span class="icon">ğŸ¢</span> Employers
      <span class="nav-badge" id="badge-employers">â€”</span>
    </div>
    <div class="nav-item" onclick="navigate('employees')">
      <span class="icon">ğŸ‘¤</span> Employees
      <span class="nav-badge" id="badge-employees">â€”</span>
    </div>

    <div class="nav-section-label">Content</div>
    <div class="nav-item" onclick="navigate('jobs')">
      <span class="icon">ğŸ“‹</span> Jobs
      <span class="nav-badge" id="badge-jobs">â€”</span>
    </div>
    <div class="nav-item" onclick="navigate('applications')">
      <span class="icon">ğŸ“¨</span> Applications
      <span class="nav-badge" id="badge-apps">â€”</span>
    </div>
  </div>
  <div class="sidebar-footer">
    <button class="logout-btn" onclick="doLogout()">â» &nbsp;Sign Out</button>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="main">
  <!-- Topbar -->
  <div id="topbar">
    <div class="topbar-title" id="topbar-title">Dashboard</div>
    <div class="search-wrapper">
      <div class="search-bar">
        <span class="search-icon">âŒ•</span>
        <input type="text" id="global-search" placeholder="Search jobs, employers, employeesâ€¦" autocomplete="off">
      </div>
      <div class="search-results" id="search-results" style="display:none;"></div>
    </div>
    <button class="topbar-refresh" onclick="refreshPage()">â†»  Refresh</button>
  </div>

  <!-- Content -->
  <div id="content">

    <!-- â”€â”€ DASHBOARD â”€â”€ -->
    <div class="page active" id="page-dashboard">
      <div class="stats-grid" id="stats-grid">
        <div class="stat-card blue">
          <div class="stat-card-bg"></div>
          <div class="stat-card-top"><div class="stat-icon">ğŸ“‹</div></div>
          <div class="stat-value" id="stat-jobs">â€”</div>
          <div class="stat-label">Total Jobs</div>
        </div>
        <div class="stat-card indigo">
          <div class="stat-card-bg"></div>
          <div class="stat-card-top"><div class="stat-icon">ğŸ¢</div></div>
          <div class="stat-value" id="stat-employers">â€”</div>
          <div class="stat-label">Employers</div>
        </div>
        <div class="stat-card green">
          <div class="stat-card-bg"></div>
          <div class="stat-card-top"><div class="stat-icon">ğŸ‘¤</div></div>
          <div class="stat-value" id="stat-employees">â€”</div>
          <div class="stat-label">Employees</div>
        </div>
        <div class="stat-card warn">
          <div class="stat-card-bg"></div>
          <div class="stat-card-top"><div class="stat-icon">ğŸ“¨</div></div>
          <div class="stat-value" id="stat-apps">â€”</div>
          <div class="stat-label">Applications</div>
        </div>
      </div>

      <div class="two-col">
        <div class="table-card">
          <div class="table-header"><div class="table-title">Recent Job Postings</div></div>
          <div id="recent-jobs-list" style="padding:4px 20px 12px;"></div>
        </div>
        <div class="table-card">
          <div class="table-header"><div class="table-title">Recent Applications</div></div>
          <div id="recent-apps-list" style="padding:4px 20px 12px;"></div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ ALL USERS â”€â”€ -->
    <div class="page" id="page-allusers">
      <div class="table-card">
        <div class="table-header">
          <div class="table-title">All Registered Users</div>
          <div class="table-filters">
            <input class="filter-input" id="allusers-search" placeholder="Search by email..." oninput="debounce(loadAllUsers, 400)()">
          </div>
        </div>
        <table>
          <thead><tr>
            <th>Email</th><th>Role</th><th>Confirmed</th><th>Last Sign In</th><th>Registered</th><th>Actions</th>
          </tr></thead>
          <tbody id="allusers-tbody">
            <tr class="loading-row"><td colspan="6"><span class="spinner"></span>Loading...</td></tr>
          </tbody>
        </table>
        <div class="pagination">
          <span id="allusers-pagination-info">-</span>
          <div class="page-btns">
            <button class="page-btn" id="allusers-prev" onclick="allusersPage(-1)" disabled>Prev</button>
            <button class="page-btn" id="allusers-next" onclick="allusersPage(1)">Next</button>
          </div>
        </div>
      </div>
    </div>

    <!-- EMPLOYERS -->
    <div class="page" id="page-employers">
      <div class="table-card">
        <div class="table-header">
          <div class="table-title">Employers</div>
          <div class="table-filters">
            <input class="filter-input" id="employer-search" placeholder="Search company nameâ€¦" oninput="debounce(loadEmployers, 400)()">
          </div>
        </div>
        <table>
          <thead><tr>
            <th>Company</th><th>Email</th><th>Jobs Posted</th><th>Joined</th><th>Actions</th>
          </tr></thead>
          <tbody id="employers-tbody">
            <tr class="loading-row"><td colspan="5"><span class="spinner"></span>Loadingâ€¦</td></tr>
          </tbody>
        </table>
        <div class="pagination">
          <span id="employers-pagination-info">â€”</span>
          <div class="page-btns">
            <button class="page-btn" id="employers-prev" onclick="employersPage(-1)" disabled>â† Prev</button>
            <button class="page-btn" id="employers-next" onclick="employersPage(1)">Next â†’</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ EMPLOYEES â”€â”€ -->
    <div class="page" id="page-employees">
      <div class="table-card">
        <div class="table-header">
          <div class="table-title">Employees</div>
          <div class="table-filters">
            <input class="filter-input" id="employee-search" placeholder="Search by nameâ€¦" oninput="debounce(loadEmployees, 400)()">
          </div>
        </div>
        <table>
          <thead><tr>
            <th>Name</th><th>Email</th><th>Phone</th><th>Joined</th><th>Actions</th>
          </tr></thead>
          <tbody id="employees-tbody">
            <tr class="loading-row"><td colspan="5"><span class="spinner"></span>Loadingâ€¦</td></tr>
          </tbody>
        </table>
        <div class="pagination">
          <span id="employees-pagination-info">â€”</span>
          <div class="page-btns">
            <button class="page-btn" id="employees-prev" onclick="employeesPage(-1)" disabled>â† Prev</button>
            <button class="page-btn" id="employees-next" onclick="employeesPage(1)">Next â†’</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ JOBS â”€â”€ -->
    <div class="page" id="page-jobs">
      <div class="table-card">
        <div class="table-header">
          <div class="table-title">Job Postings</div>
          <div class="table-filters">
            <input class="filter-input" id="jobs-search" placeholder="Search titleâ€¦" oninput="debounce(loadJobs, 400)()">
          </div>
        </div>
        <table>
          <thead><tr>
            <th>Title</th><th>Company</th><th>City</th><th>Salary</th><th>Applicants</th><th>Posted</th><th>Actions</th>
          </tr></thead>
          <tbody id="jobs-tbody">
            <tr class="loading-row"><td colspan="7"><span class="spinner"></span>Loadingâ€¦</td></tr>
          </tbody>
        </table>
        <div class="pagination">
          <span id="jobs-pagination-info">â€”</span>
          <div class="page-btns">
            <button class="page-btn" id="jobs-prev" onclick="jobsPage(-1)" disabled>â† Prev</button>
            <button class="page-btn" id="jobs-next" onclick="jobsPage(1)">Next â†’</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ APPLICATIONS â”€â”€ -->
    <div class="page" id="page-applications">
      <div class="table-card">
        <div class="table-header">
          <div class="table-title">Applications</div>
          <div class="table-filters">
            <input class="filter-input" id="apps-email-filter" placeholder="Filter by emailâ€¦" oninput="debounce(loadApplications, 400)()">
            <input class="filter-input" id="apps-job-filter" placeholder="Filter by Job IDâ€¦" oninput="debounce(loadApplications, 400)()">
          </div>
        </div>
        <table>
          <thead><tr>
            <th>Applicant</th><th>Email</th><th>Phone</th><th>Job ID</th><th>Applied</th><th>Actions</th>
          </tr></thead>
          <tbody id="applications-tbody">
            <tr class="loading-row"><td colspan="6"><span class="spinner"></span>Loadingâ€¦</td></tr>
          </tbody>
        </table>
        <div class="pagination">
          <span id="applications-pagination-info">â€”</span>
          <div class="page-btns">
            <button class="page-btn" id="applications-prev" onclick="applicationsPage(-1)" disabled>â† Prev</button>
            <button class="page-btn" id="applications-next" onclick="applicationsPage(1)">Next â†’</button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</div><!-- /main -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Employer Detail Modal -->
<div class="modal-overlay" id="modal-employer">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="modal-employer-title">Employer Details</div>
      <button class="modal-close" onclick="closeModal('modal-employer')">âœ•</button>
    </div>
    <div class="modal-body" id="modal-employer-body"></div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-sm" id="modal-employer-delete-btn">ğŸ—‘ Delete User</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modal-employer')">Close</button>
    </div>
  </div>
</div>

<!-- Employee Detail Modal -->
<div class="modal-overlay" id="modal-employee">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="modal-employee-title">Employee Details</div>
      <button class="modal-close" onclick="closeModal('modal-employee')">âœ•</button>
    </div>
    <div class="modal-body" id="modal-employee-body"></div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-sm" id="modal-employee-delete-btn">ğŸ—‘ Delete User</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modal-employee')">Close</button>
    </div>
  </div>
</div>

<!-- Job Detail Modal -->
<div class="modal-overlay" id="modal-job">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="modal-job-title">Job Details</div>
      <button class="modal-close" onclick="closeModal('modal-job')">âœ•</button>
    </div>
    <div class="modal-body" id="modal-job-body"></div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-sm" id="modal-job-delete-btn">ğŸ—‘ Delete Job</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modal-job')">Close</button>
    </div>
  </div>
</div>

<!-- Application Detail Modal -->
<div class="modal-overlay" id="modal-application">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title">Application Details</div>
      <button class="modal-close" onclick="closeModal('modal-application')">âœ•</button>
    </div>
    <div class="modal-body" id="modal-application-body"></div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-sm" id="modal-app-delete-btn">ğŸ—‘ Delete Application</button>
      <button class="btn btn-ghost btn-sm" onclick="closeModal('modal-application')">Close</button>
    </div>
  </div>
</div>

<!-- Confirm Dialog -->
<div class="confirm-overlay" id="confirm-dialog">
  <div class="confirm-box">
    <div class="confirm-icon">âš ï¸</div>
    <div class="confirm-title" id="confirm-title">Are you sure?</div>
    <div class="confirm-msg" id="confirm-msg">This action cannot be undone.</div>
    <div class="confirm-btns">
      <button class="btn btn-ghost" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-danger" id="confirm-ok-btn">Delete</button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let API    = '';
let AKEY   = '';
let currentPage = 'dashboard';

// Pagination offsets
const state = {
  allusers:     { offset: 0, limit: 20, total: 0, data: [] },
  employers:    { offset: 0, limit: 20, total: 0 },
  employees:    { offset: 0, limit: 20, total: 0 },
  jobs:         { offset: 0, limit: 20, total: 0 },
  applications: { offset: 0, limit: 20, total: 0 },
};

/* â”€â”€ API Helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function api(path, method = 'GET', body = null) {
  const opts = {
    method,
    headers: {
      'Content-Type': 'application/json',
      'X-Admin-Key': AKEY,
    },
  };
  if (body) opts.body = JSON.stringify(body);
  const res = await fetch(API + path, opts);
  if (!res.ok) {
    const err = await res.json().catch(() => ({ detail: res.statusText }));
    throw new Error(err.detail || 'Request failed');
  }
  return res.json();
}

/* â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function doLogin() {
  const endpoint = 'https://laborgrow-production.up.railway.app';
  const key      = document.getElementById('login-key').value.trim();
  const errEl    = document.getElementById('login-error');
  errEl.textContent = '';

  if (!key) { errEl.textContent = 'Please enter the admin key.'; return; }

  const btn = document.querySelector('.login-btn');
  btn.textContent = 'Connectingâ€¦';
  btn.disabled = true;

  try {
    API  = endpoint;
    AKEY = key;
    await api('/admin/dashboard');

    document.getElementById('login-screen').classList.add('hidden');
    loadDashboard();
    toast('Connected to LaborGrow API', 'success');
  } catch (e) {
    errEl.textContent = 'Auth failed: ' + e.message;
    API = ''; AKEY = '';
  } finally {
    btn.textContent = 'Access Panel â†’';
    btn.disabled = false;
  }
}
document.getElementById('login-key').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });

function doLogout() {
  API = ''; AKEY = '';
  document.getElementById('login-screen').classList.remove('hidden');
  document.getElementById('login-key').value = '';
  document.getElementById('login-error').textContent = '';
}

/* â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function navigate(page) {
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.querySelectorAll(`[onclick="navigate('${page}')"]`).forEach(el => el.classList.add('active'));
  document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');

  const titles = { dashboard: 'Dashboard', allusers: 'All Registered Users', employers: 'Employers', employees: 'Employees', jobs: 'Job Postings', applications: 'Applications' };
  document.getElementById('topbar-title').textContent = titles[page] || page;
  currentPage = page;

  const loaders = { dashboard: loadDashboard, allusers: loadAllUsers, employers: loadEmployers, employees: loadEmployees, jobs: loadJobs, applications: loadApplications };
  if (loaders[page]) loaders[page]();
}

function refreshPage() {
  const loaders2 = { dashboard: loadDashboard, allusers: loadAllUsers, employers: loadEmployers, employees: loadEmployees, jobs: loadJobs, applications: loadApplications };
  if (loaders2[currentPage]) loaders2[currentPage]();
  toast('Refreshed', 'info');
}

/* â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadDashboard() {
  try {
    const d = await api('/admin/dashboard');
    const s = d.stats;

    document.getElementById('stat-jobs').textContent      = s.total_jobs ?? 'â€”';
    document.getElementById('stat-employers').textContent = s.total_employers ?? 'â€”';
    document.getElementById('badge-allusers').textContent = s.total_auth_users ?? 'â€”';
    document.getElementById('stat-employees').textContent = s.total_employees ?? 'â€”';
    document.getElementById('stat-apps').textContent      = s.total_applications ?? 'â€”';

    // Update sidebar badges
    document.getElementById('badge-jobs').textContent      = s.total_jobs ?? 'â€”';
    document.getElementById('badge-employers').textContent = s.total_employers ?? 'â€”';
    document.getElementById('badge-employees').textContent = s.total_employees ?? 'â€”';
    document.getElementById('badge-apps').textContent      = s.total_applications ?? 'â€”';

    // Recent jobs
    const rjEl = document.getElementById('recent-jobs-list');
    if (d.recent_jobs && d.recent_jobs.length) {
      rjEl.innerHTML = d.recent_jobs.map(j => `
        <div class="recent-item">
          <div>
            <div class="recent-item-name">${esc(j.title)}</div>
            <div class="recent-item-sub">${esc(j.company_name)} Â· ${esc(j.job_city)}</div>
          </div>
          <div class="recent-item-right">
            <div style="font-size:10px;color:var(--muted)">${fmtDate(j.created_at)}</div>
          </div>
        </div>`).join('');
    } else {
      rjEl.innerHTML = '<div style="padding:20px;text-align:center;font-size:12px;color:var(--muted)">No recent jobs</div>';
    }

    // Recent apps
    const raEl = document.getElementById('recent-apps-list');
    if (d.recent_applications && d.recent_applications.length) {
      raEl.innerHTML = d.recent_applications.map(a => `
        <div class="recent-item">
          <div>
            <div class="recent-item-name">${esc(a.full_name)}</div>
            <div class="recent-item-sub">${esc(a.email)}</div>
          </div>
          <div class="recent-item-right">
            <div style="font-size:10px;color:var(--muted)">${fmtDate(a.applied_at)}</div>
          </div>
        </div>`).join('');
    } else {
      raEl.innerHTML = '<div style="padding:20px;text-align:center;font-size:12px;color:var(--muted)">No recent applications</div>';
    }

  } catch (e) {
    toast('Dashboard load failed: ' + e.message, 'error');
  }
}


/* â”€â”€ All Registered Users â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let allUsersCache = [];

async function loadAllUsers() {
  const s      = state.allusers;
  const search = document.getElementById('allusers-search').value;
  const tb     = document.getElementById('allusers-tbody');
  tb.innerHTML = `<tr class="loading-row"><td colspan="6"><span class="spinner"></span>Loading...</td></tr>`;
  try {
    let url = '/admin/users/all';
    if (search) url += '?search=' + encodeURIComponent(search);
    const d     = await api(url);
    allUsersCache = d.users || [];

    // Client-side pagination on full list
    const paged = allUsersCache.slice(s.offset, s.offset + s.limit);
    document.getElementById('allusers-pagination-info').textContent =
      paged.length ? `Showing ${s.offset+1}â€“${s.offset+paged.length} of ${allUsersCache.length}` : 'No results';
    document.getElementById('badge-allusers').textContent = allUsersCache.length;
    document.getElementById('allusers-prev').disabled = s.offset === 0;
    document.getElementById('allusers-next').disabled = s.offset + s.limit >= allUsersCache.length;

    if (!paged.length) {
      tb.innerHTML = `<tr class="empty-row"><td colspan="6">No registered users found</td></tr>`;
      return;
    }
    const roleColors = { employer: 'badge-blue', employee: 'badge-green', unknown: 'badge-gray' };
    tb.innerHTML = paged.map(u => `
      <tr>
        <td>${esc(u.email)}</td>
        <td><span class="badge ${roleColors[u.role] || 'badge-gray'}">${esc(u.role)}</span></td>
        <td><span class="badge ${u.confirmed ? 'badge-green' : 'badge-warn'}">${u.confirmed ? 'Yes' : 'Pending'}</span></td>
        <td class="text-muted">${fmtDate(u.last_sign_in_at)}</td>
        <td class="text-muted">${fmtDate(u.created_at)}</td>
        <td>
          <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser('${u.id}', '${esc(u.email)}')">Delete</button>
        </td>
      </tr>`).join('');
  } catch (e) {
    tb.innerHTML = `<tr class="empty-row"><td colspan="6" class="text-danger">Error: ${esc(e.message)}</td></tr>`;
  }
}

function allusersPage(dir) {
  const s = state.allusers;
  s.offset = Math.max(0, s.offset + dir * s.limit);
  // Re-render from cache, don't re-fetch
  const paged = allUsersCache.slice(s.offset, s.offset + s.limit);
  document.getElementById('allusers-pagination-info').textContent =
    paged.length ? `Showing ${s.offset+1}â€“${s.offset+paged.length} of ${allUsersCache.length}` : 'No results';
  document.getElementById('allusers-prev').disabled = s.offset === 0;
  document.getElementById('allusers-next').disabled = s.offset + s.limit >= allUsersCache.length;
  const roleColors = { employer: 'badge-blue', employee: 'badge-green', unknown: 'badge-gray' };
  const tb = document.getElementById('allusers-tbody');
  if (!paged.length) { tb.innerHTML = `<tr class="empty-row"><td colspan="6">No results</td></tr>`; return; }
  tb.innerHTML = paged.map(u => `
    <tr>
      <td>${esc(u.email)}</td>
      <td><span class="badge ${roleColors[u.role] || 'badge-gray'}">${esc(u.role)}</span></td>
      <td><span class="badge ${u.confirmed ? 'badge-green' : 'badge-warn'}">${u.confirmed ? 'Yes' : 'Pending'}</span></td>
      <td class="text-muted">${fmtDate(u.last_sign_in_at)}</td>
      <td class="text-muted">${fmtDate(u.created_at)}</td>
      <td>
        <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser('${u.id}', '${esc(u.email)}')">Delete</button>
      </td>
    </tr>`).join('');
}

/* â”€â”€ Employers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadEmployers() {
  const s   = state.employers;
  const q   = document.getElementById('employer-search').value;
  const url = `/admin/users/employers?limit=${s.limit}&offset=${s.offset}${q ? '&search='+encodeURIComponent(q) : ''}`;
  const tb  = document.getElementById('employers-tbody');
  tb.innerHTML = `<tr class="loading-row"><td colspan="5"><span class="spinner"></span>Loadingâ€¦</td></tr>`;
  try {
    const d = await api(url);
    const items = d.employers || [];
    s.total = d.count || items.length;

    if (!items.length) {
      tb.innerHTML = `<tr class="empty-row"><td colspan="5">No employers found</td></tr>`;
    } else {
      tb.innerHTML = items.map(e => `
        <tr>
          <td><strong>${esc(e.company_name || 'â€”')}</strong></td>
          <td class="truncate">${esc(e.email)}</td>
          <td><span class="badge badge-blue">${e.job_count ?? 'â€”'}</span></td>
          <td class="text-muted">${fmtDate(e.created_at)}</td>
          <td>
            <button class="btn btn-ghost btn-sm" onclick="viewEmployer('${e.id}')">View</button>
            <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser('${e.id}', '${esc(e.company_name)}')">Delete</button>
          </td>
        </tr>`).join('');
    }
    updatePagination('employers', items.length);
  } catch (e) {
    tb.innerHTML = `<tr class="empty-row"><td colspan="5" class="text-danger">Error: ${esc(e.message)}</td></tr>`;
  }
}

async function viewEmployer(id) {
  const body = document.getElementById('modal-employer-body');
  body.innerHTML = `<div style="text-align:center;padding:20px"><span class="spinner"></span></div>`;
  openModal('modal-employer');
  try {
    const d = await api(`/admin/users/employers/${id}`);
    const e = d.employer;
    document.getElementById('modal-employer-title').textContent = e.company_name || 'Employer';
    body.innerHTML = `
      <div class="detail-grid mb-4">
        <div class="detail-field"><label>ID</label><div class="value mono" style="font-size:10px;color:var(--muted)">${esc(e.id)}</div></div>
        <div class="detail-field"><label>Joined</label><div class="value">${fmtDate(e.created_at)}</div></div>
        <div class="detail-field"><label>Company</label><div class="value">${esc(e.company_name || 'â€”')}</div></div>
        <div class="detail-field"><label>Email</label><div class="value">${esc(e.email)}</div></div>
      </div>
      <div class="section-title mb-4" style="font-size:13px">Job Postings (${(d.jobs||[]).length})</div>
      ${(d.jobs||[]).length ? `
        <div style="max-height:240px;overflow-y:auto">
          ${(d.jobs||[]).map(j => `
            <div class="recent-item">
              <div>
                <div class="recent-item-name">${esc(j.title)}</div>
                <div class="recent-item-sub">${esc(j.job_city)} Â· ${fmtSalary(j.salary_min, j.salary_max)}</div>
              </div>
              <span class="badge badge-green">${j.openings} open</span>
            </div>`).join('')}
        </div>` : `<div class="text-muted" style="font-size:12px">No jobs posted yet</div>`}`;

    document.getElementById('modal-employer-delete-btn').onclick = () => {
      closeModal('modal-employer');
      confirmDeleteUser(e.id, e.company_name);
    };
  } catch (err) {
    body.innerHTML = `<div class="text-danger">${esc(err.message)}</div>`;
  }
}

function employersPage(dir) {
  const s = state.employers;
  s.offset = Math.max(0, s.offset + dir * s.limit);
  loadEmployers();
}

/* â”€â”€ Employees â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadEmployees() {
  const s   = state.employees;
  const q   = document.getElementById('employee-search').value;
  const url = `/admin/users/employees?limit=${s.limit}&offset=${s.offset}${q ? '&search='+encodeURIComponent(q) : ''}`;
  const tb  = document.getElementById('employees-tbody');
  tb.innerHTML = `<tr class="loading-row"><td colspan="5"><span class="spinner"></span>Loadingâ€¦</td></tr>`;
  try {
    const d     = await api(url);
    const items = d.employees || [];
    s.total = d.count || items.length;

    if (!items.length) {
      tb.innerHTML = `<tr class="empty-row"><td colspan="5">No employees found</td></tr>`;
    } else {
      tb.innerHTML = items.map(e => `
        <tr>
          <td><strong>${esc(e.full_name || 'â€”')}</strong></td>
          <td class="truncate">${esc(e.email)}</td>
          <td>${esc(e.phone || 'â€”')}</td>
          <td class="text-muted">${fmtDate(e.created_at)}</td>
          <td>
            <button class="btn btn-ghost btn-sm" onclick="viewEmployee('${e.id}')">View</button>
            <button class="btn btn-danger btn-sm" onclick="confirmDeleteUser('${e.id}', '${esc(e.full_name || e.email)}')">Delete</button>
          </td>
        </tr>`).join('');
    }
    updatePagination('employees', items.length);
  } catch (e) {
    tb.innerHTML = `<tr class="empty-row"><td colspan="5" class="text-danger">Error: ${esc(e.message)}</td></tr>`;
  }
}

async function viewEmployee(id) {
  const body = document.getElementById('modal-employee-body');
  body.innerHTML = `<div style="text-align:center;padding:20px"><span class="spinner"></span></div>`;
  openModal('modal-employee');
  try {
    const d = await api(`/admin/users/employees/${id}`);
    const e = d.employee;
    document.getElementById('modal-employee-title').textContent = e.full_name || 'Employee';
    body.innerHTML = `
      <div class="detail-grid mb-4">
        <div class="detail-field"><label>ID</label><div class="value mono" style="font-size:10px;color:var(--muted)">${esc(e.id)}</div></div>
        <div class="detail-field"><label>Joined</label><div class="value">${fmtDate(e.created_at)}</div></div>
        <div class="detail-field"><label>Full Name</label><div class="value">${esc(e.full_name || 'â€”')}</div></div>
        <div class="detail-field"><label>Email</label><div class="value">${esc(e.email)}</div></div>
        <div class="detail-field"><label>Phone</label><div class="value">${esc(e.phone || 'â€”')}</div></div>
      </div>
      <div class="section-title mb-4" style="font-size:13px">Applications (${(d.applications||[]).length})</div>
      ${(d.applications||[]).length ? `
        <div style="max-height:240px;overflow-y:auto">
          ${(d.applications||[]).map(a => `
            <div class="recent-item">
              <div>
                <div class="recent-item-name mono" style="font-size:11px">${esc(a.job_id)}</div>
                <div class="recent-item-sub">${fmtDate(a.applied_at)}</div>
              </div>
              <button class="btn btn-danger btn-sm" onclick="confirmDeleteApp('${a.id}')">Remove</button>
            </div>`).join('')}
        </div>` : `<div class="text-muted" style="font-size:12px">No applications yet</div>`}`;

    document.getElementById('modal-employee-delete-btn').onclick = () => {
      closeModal('modal-employee');
      confirmDeleteUser(e.id, e.full_name || e.email);
    };
  } catch (err) {
    body.innerHTML = `<div class="text-danger">${esc(err.message)}</div>`;
  }
}

function employeesPage(dir) {
  const s = state.employees;
  s.offset = Math.max(0, s.offset + dir * s.limit);
  loadEmployees();
}

/* â”€â”€ Jobs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadJobs() {
  const s   = state.jobs;
  const q   = document.getElementById('jobs-search').value;
  const url = `/admin/jobs?limit=${s.limit}&offset=${s.offset}${q ? '&search='+encodeURIComponent(q) : ''}`;
  const tb  = document.getElementById('jobs-tbody');
  tb.innerHTML = `<tr class="loading-row"><td colspan="7"><span class="spinner"></span>Loadingâ€¦</td></tr>`;
  try {
    const d     = await api(url);
    const items = d.jobs || [];
    s.total = d.count || items.length;

    if (!items.length) {
      tb.innerHTML = `<tr class="empty-row"><td colspan="7">No jobs found</td></tr>`;
    } else {
      tb.innerHTML = items.map(j => `
        <tr>
          <td><strong class="truncate" style="display:block">${esc(j.title)}</strong></td>
          <td class="truncate">${esc(j.company_name)}</td>
          <td>${esc(j.job_city)}</td>
          <td>${fmtSalary(j.salary_min, j.salary_max)}</td>
          <td><span class="badge badge-warn">${j.applicant_count ?? 'â€”'}</span></td>
          <td class="text-muted">${fmtDate(j.created_at)}</td>
          <td>
            <button class="btn btn-ghost btn-sm" onclick="viewJob('${j.id}')">View</button>
            <button class="btn btn-danger btn-sm" onclick="confirmDeleteJob('${j.id}', '${esc(j.title)}')">Delete</button>
          </td>
        </tr>`).join('');
    }
    updatePagination('jobs', items.length);
  } catch (e) {
    tb.innerHTML = `<tr class="empty-row"><td colspan="7" class="text-danger">Error: ${esc(e.message)}</td></tr>`;
  }
}

async function viewJob(id) {
  const body = document.getElementById('modal-job-body');
  body.innerHTML = `<div style="text-align:center;padding:20px"><span class="spinner"></span></div>`;
  openModal('modal-job');
  try {
    const j = await api(`/jobs/${id}`);
    document.getElementById('modal-job-title').textContent = j.title || 'Job';
    const skills = Array.isArray(j.required_skills) ? j.required_skills : [];
    body.innerHTML = `
      <div class="detail-grid mb-4">
        <div class="detail-field"><label>ID</label><div class="value mono" style="font-size:10px;color:var(--muted)">${esc(j.id)}</div></div>
        <div class="detail-field"><label>Posted</label><div class="value">${fmtDate(j.created_at)}</div></div>
        <div class="detail-field"><label>Company</label><div class="value">${esc(j.company_name)}</div></div>
        <div class="detail-field"><label>City</label><div class="value">${esc(j.job_city)}</div></div>
        <div class="detail-field"><label>Salary</label><div class="value text-accent">${fmtSalary(j.salary_min, j.salary_max)}</div></div>
        <div class="detail-field"><label>Openings</label><div class="value">${j.openings}</div></div>
        <div class="detail-field"><label>Experience</label><div class="value">${esc(j.total_experience || 'â€”')}</div></div>
        <div class="detail-field"><label>Hiring Speed</label><div class="value">${esc(j.hiring_speed || 'â€”')}</div></div>
        <div class="detail-field"><label>Contact Person</label><div class="value">${esc(j.contact_person || 'â€”')}</div></div>
        <div class="detail-field"><label>Contact Email</label><div class="value">${esc(j.contact_email || j.email || 'â€”')}</div></div>
        <div class="detail-field full"><label>Required Skills</label><div class="value">${skills.length ? skills.map(s => `<span class="skill-tag">${esc(s)}</span>`).join('') : 'â€”'}</div></div>
      </div>`;

    document.getElementById('modal-job-delete-btn').onclick = () => {
      closeModal('modal-job');
      confirmDeleteJob(j.id, j.title);
    };
  } catch (err) {
    body.innerHTML = `<div class="text-danger">${esc(err.message)}</div>`;
  }
}

function jobsPage(dir) {
  const s = state.jobs;
  s.offset = Math.max(0, s.offset + dir * s.limit);
  loadJobs();
}

/* â”€â”€ Applications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadApplications() {
  const s     = state.applications;
  const email = document.getElementById('apps-email-filter').value;
  const jobId = document.getElementById('apps-job-filter').value;
  let url = `/admin/applications?limit=${s.limit}&offset=${s.offset}`;
  if (email) url += '&email=' + encodeURIComponent(email);
  if (jobId) url += '&job_id=' + encodeURIComponent(jobId);

  const tb = document.getElementById('applications-tbody');
  tb.innerHTML = `<tr class="loading-row"><td colspan="6"><span class="spinner"></span>Loadingâ€¦</td></tr>`;
  try {
    const d     = await api(url);
    const items = d.applications || [];
    s.total = d.count || items.length;

    if (!items.length) {
      tb.innerHTML = `<tr class="empty-row"><td colspan="6">No applications found</td></tr>`;
    } else {
      tb.innerHTML = items.map(a => `
        <tr>
          <td><strong>${esc(a.full_name)}</strong></td>
          <td class="truncate">${esc(a.email)}</td>
          <td>${esc(a.phone || 'â€”')}</td>
          <td><span class="mono text-muted" style="font-size:10px">${esc(a.job_id?.slice(0,8))}â€¦</span></td>
          <td class="text-muted">${fmtDate(a.applied_at)}</td>
          <td>
            <button class="btn btn-ghost btn-sm" onclick="viewApplication(${JSON.stringify(a).split('"').join('&quot;')})">View</button>
            <button class="btn btn-danger btn-sm" onclick="confirmDeleteApp('${a.id}')">Delete</button>
          </td>
        </tr>`).join('');
    }
    updatePagination('applications', items.length);
  } catch (e) {
    tb.innerHTML = `<tr class="empty-row"><td colspan="6" class="text-danger">Error: ${esc(e.message)}</td></tr>`;
  }
}

function viewApplication(a) {
  const body = document.getElementById('modal-application-body');
  body.innerHTML = `
    <div class="detail-grid mb-4">
      <div class="detail-field"><label>ID</label><div class="value mono" style="font-size:10px;color:var(--muted)">${esc(a.id)}</div></div>
      <div class="detail-field"><label>Applied</label><div class="value">${fmtDate(a.applied_at)}</div></div>
      <div class="detail-field"><label>Full Name</label><div class="value">${esc(a.full_name)}</div></div>
      <div class="detail-field"><label>Email</label><div class="value">${esc(a.email)}</div></div>
      <div class="detail-field"><label>Phone</label><div class="value">${esc(a.phone || 'â€”')}</div></div>
      <div class="detail-field"><label>Job ID</label><div class="value mono" style="font-size:11px">${esc(a.job_id)}</div></div>
      <div class="detail-field full"><label>Cover Note</label><div class="value" style="line-height:1.6;color:var(--muted)">${esc(a.cover_note || 'No cover note provided')}</div></div>
    </div>`;
  document.getElementById('modal-app-delete-btn').onclick = () => {
    closeModal('modal-application');
    confirmDeleteApp(a.id);
  };
  openModal('modal-application');
}

function applicationsPage(dir) {
  const s = state.applications;
  s.offset = Math.max(0, s.offset + dir * s.limit);
  loadApplications();
}

/* â”€â”€ Delete Confirmations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function confirmDeleteUser(id, name) {
  showConfirm(
    'Delete User?',
    `This will permanently delete <strong>${esc(name)}</strong> and all their associated jobs and applications. This cannot be undone.`,
    async () => {
      try {
        await api(`/admin/users/${id}`, 'DELETE');
        toast('User deleted', 'success');
        refreshPage();
      } catch (e) { toast('Delete failed: ' + e.message, 'error'); }
    }
  );
}

function confirmDeleteJob(id, title) {
  showConfirm(
    'Delete Job?',
    `This will permanently delete <strong>${esc(title)}</strong> and all its applications.`,
    async () => {
      try {
        await api(`/admin/jobs/${id}`, 'DELETE');
        toast('Job deleted', 'success');
        loadJobs();
      } catch (e) { toast('Delete failed: ' + e.message, 'error'); }
    }
  );
}

function confirmDeleteApp(id) {
  showConfirm(
    'Delete Application?',
    'This will permanently remove this application record.',
    async () => {
      try {
        await api(`/admin/applications/${id}`, 'DELETE');
        toast('Application deleted', 'success');
        loadApplications();
      } catch (e) { toast('Delete failed: ' + e.message, 'error'); }
    }
  );
}

/* â”€â”€ Confirm Dialog â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let confirmCallback = null;
function showConfirm(title, msg, cb) {
  document.getElementById('confirm-title').textContent = title;
  document.getElementById('confirm-msg').innerHTML = msg;
  confirmCallback = cb;
  document.getElementById('confirm-dialog').classList.add('open');
}
function closeConfirm() {
  document.getElementById('confirm-dialog').classList.remove('open');
  confirmCallback = null;
}
document.getElementById('confirm-ok-btn').onclick = () => {
  closeConfirm();
  if (confirmCallback) confirmCallback();
};

/* â”€â”€ Modal Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

// Close modal on overlay click
document.querySelectorAll('.modal-overlay').forEach(el => {
  el.addEventListener('click', e => { if (e.target === el) el.classList.remove('open'); });
});
document.getElementById('confirm-dialog').addEventListener('click', e => {
  if (e.target === document.getElementById('confirm-dialog')) closeConfirm();
});

/* â”€â”€ Global Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const searchInput = document.getElementById('global-search');
const searchResults = document.getElementById('search-results');
let searchTimeout;

searchInput.addEventListener('input', () => {
  clearTimeout(searchTimeout);
  const q = searchInput.value.trim();
  if (q.length < 2) { searchResults.style.display = 'none'; return; }
  searchTimeout = setTimeout(() => doSearch(q), 350);
});

searchInput.addEventListener('focus', () => {
  if (searchInput.value.length >= 2) searchResults.style.display = 'block';
});

document.addEventListener('click', e => {
  if (!e.target.closest('.search-wrapper')) searchResults.style.display = 'none';
});

async function doSearch(q) {
  searchResults.innerHTML = `<div style="padding:16px;text-align:center;font-size:12px;color:var(--muted)"><span class="spinner"></span> Searchingâ€¦</div>`;
  searchResults.style.display = 'block';
  try {
    const d = await api('/admin/search?q=' + encodeURIComponent(q));
    const r = d.results;
    let html = '';

    if (r.jobs && r.jobs.length) {
      html += `<div class="search-results-section"><div class="search-results-label">Jobs</div>` +
        r.jobs.map(j => `<div class="search-result-item" onclick="navigate('jobs')">
          <div><div class="search-result-name">${esc(j.title)}</div><div class="search-result-sub">${esc(j.company_name)} Â· ${esc(j.job_city)}</div></div>
          <span class="badge badge-gray">job</span></div>`).join('') + `</div>`;
    }
    if (r.employers && r.employers.length) {
      html += `<div class="search-results-section"><div class="search-results-label">Employers</div>` +
        r.employers.map(e => `<div class="search-result-item" onclick="viewEmployer('${e.id}');searchResults.style.display='none'">
          <div><div class="search-result-name">${esc(e.company_name)}</div><div class="search-result-sub">${esc(e.email)}</div></div>
          <span class="badge badge-blue">employer</span></div>`).join('') + `</div>`;
    }
    if (r.employees && r.employees.length) {
      html += `<div class="search-results-section"><div class="search-results-label">Employees</div>` +
        r.employees.map(e => `<div class="search-result-item" onclick="viewEmployee('${e.id}');searchResults.style.display='none'">
          <div><div class="search-result-name">${esc(e.full_name || 'â€”')}</div><div class="search-result-sub">${esc(e.email)}</div></div>
          <span class="badge badge-warn">employee</span></div>`).join('') + `</div>`;
    }

    if (r.auth_users && r.auth_users.length && !r.employees?.length) {
      html += `<div class="search-results-section"><div class="search-results-label">Auth Users</div>` +
        r.auth_users.map(u => `<div class="search-result-item" onclick="navigate('allusers');searchResults.style.display='none'">
          <div><div class="search-result-name">${esc(u.email)}</div><div class="search-result-sub">${fmtDate(u.created_at)}</div></div>
          <span class="badge badge-gray">user</span></div>`).join('') + `</div>`;
    }
    if (!html) html = `<div style="padding:16px;text-align:center;font-size:12px;color:var(--muted)">No results for "${esc(q)}"</div>`;
    searchResults.innerHTML = html;
  } catch (e) {
    searchResults.innerHTML = `<div style="padding:12px;font-size:12px;color:var(--danger)">Search failed</div>`;
  }
}

/* â”€â”€ Pagination Helper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updatePagination(key, count) {
  const s    = state[key];
  const from = s.offset + 1;
  const to   = s.offset + count;
  document.getElementById(`${key}-pagination-info`).textContent = count ? `Showing ${from}â€“${to}` : 'No results';
  document.getElementById(`${key}-prev`).disabled = s.offset === 0;
  document.getElementById(`${key}-next`).disabled = count < s.limit;
}

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function toast(msg, type = 'info') {
  const icons = { success: 'âœ“', error: 'âœ•', info: 'â„¹' };
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${icons[type]}</span> ${esc(msg)}`;
  document.getElementById('toast-container').appendChild(el);
  setTimeout(() => { el.classList.add('fading'); setTimeout(() => el.remove(), 350); }, 3000);
}

/* â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function esc(str) {
  if (str == null) return '';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function fmtDate(iso) {
  if (!iso) return 'â€”';
  const d = new Date(iso);
  return d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
}

function fmtSalary(min, max) {
  if (!min && !max) return 'â€”';
  const fmt = n => n >= 1000 ? (n/1000).toFixed(n % 1000 === 0 ? 0 : 1) + 'k' : n;
  if (min && max) return `â‚¹${fmt(min)}â€“${fmt(max)}`;
  if (min) return `â‚¹${fmt(min)}+`;
  return `up to â‚¹${fmt(max)}`;
}

function debounce(fn, delay) {
  let t;
  return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), delay); };
}

/* â”€â”€ Keyboard shortcuts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal-overlay.open').forEach(el => el.classList.remove('open'));
    closeConfirm();
    searchResults.style.display = 'none';
  }
  if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
    e.preventDefault();
    searchInput.focus();
    searchInput.select();
  }
});
</script>
</body>
</html>